#!/usr/bin/env python

# Python script for replacement of single string in multiple files

# Use in conjunction with git reset --hard for testing, assuming all
# previous changes were commited.
# Grep the text of interest to make sure you cover all possible forms.
# Do not run within the directory you are changing since that will 
# replace text in this file.

import os       

# Directory info
dirpath = "/n/home08/elundgren/code/code.gcc_14.5.1/src/HEMCO/src/Extensions"

# String info
old_text = "HcoState%doVerbose"
new_text = "HcoState%Config%doVerbose"

for dname, dirs, files in os.walk(dirpath, topdown=False):
    if '.git' in dname:
        continue
    elif 'Preprocess' in dname:
        continue
    else:
        print('Directory {}'.format(dname))
        for fname in files:
            if '.F' not in fname:
                print(' --> Skipping {}'.format(fname))
                continue
            if 'hcox_gfed_mod' in fname:
                print(' --> Skipping {}'.format(fname))
                continue
            if 'interpreter' in fname:
                print(' --> Skipping {}'.format(fname))
                continue
            rewrite = False
            print(' --> File: {}'.format(fname))
            fpath = os.path.join(dname, fname)
            with open(fpath) as f:
                s = f.read()
                if old_text in s:
                    s = s.replace(old_text, new_text)
                    rewrite = True
                    print('   --> Replacing text in {}'.format(fname))
            if rewrite == True:
                with open(fpath, "w") as f:
                    f.write(s)
